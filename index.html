<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Maki Host - Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
  <style>
    /* ... (el CSS completo igual que antes, diseño cyan cards, sidebar, etc.) ... */
    body {
      margin: 0;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      background: linear-gradient(135deg, #38bdf8 0%, #0f172a 100%);
      min-height: 100vh;
      color: #e2e8f0;
      display: flex;
      flex-direction: column;
      transition: background 0.3s, color 0.3s;
    }
    /* ... resto igual ... */
    .container { display: flex; min-height: 100vh; }
    /* ... todos los estilos igual que el diseño anterior ... */
    .footer {
      width: 100%;
      background: rgba(15,23,42,0.96);
      color: #38bdf8;
      padding: 18px 0 10px 0;
      text-align: center;
      font-size: 1.05em;
      position: fixed;
      left: 0;
      bottom: 0;
      z-index: 99;
      letter-spacing: 1px;
    }
    .admin-modal-bg2 {
      position: fixed;
      top: 0; left: 0; right:0; bottom:0;
      background: #0f172acc 0.93;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .admin-panel2 {
      background: #1e293b;
      color: #e2e8f0;
      border-radius: 18px;
      box-shadow: 0 4px 36px #38bdf822;
      padding: 36px 32px;
      min-width: 320px;
      max-width: 400px;
      position: relative;
      transition: background 0.3s, color 0.3s;
    }
    .color-row { display: flex; gap:18px; align-items:center; margin-bottom:20px; }
    .add-role-row { margin-top:18px; display:flex; gap:8px; align-items:center; }
    .add-role-row input { background:#334155; color:#38bdf8; border:none; border-radius:5px; padding:4px 8px; font-size:1em; }
    .add-role-row button { background:#38bdf8; color:#0f172a; border:none; border-radius:5px; padding:6px 12px; font-weight:bold; font-size:1em; cursor:pointer; }
    .admin-close-btn { background: #334155; color: #38bdf8; border: none; border-radius: 7px; padding: 8px 14px; font-weight: bold; font-size: 1em; margin-top: 24px; cursor: pointer; display: block; margin-left: auto; margin-right: auto;}
  </style>
</head>
<body>
<div id="authPanels"></div>
<div class="container" id="container" style="display:none">
  <!-- Panel normal aquí (igual que antes) -->
</div>
<div class="footer">© Maki Host | Todos los derechos reservados</div>
<!-- Panel de administración especial (Félix Manuel) -->
<div id="adminModal2" class="admin-modal-bg2" style="display:none">
  <div class="admin-panel2" id="specialPanel2">
    <h2>Administración avanzada</h2>
    <div class="color-row">
      <label>Texto: <input type="color" id="colorText"></label>
      <label>Fondo: <input type="color" id="colorBg"></label>
    </div>
    <div style="margin-top:16px;">
      <h3 style="color:#38bdf8;">Editar roles de usuario</h3>
      <div id="specialAdminUsers"></div>
      <div class="add-role-row">
        <input id="addRoleUser" placeholder="Usuario" />
        <select id="addRoleSelect">
          <option value="admin">admin</option>
          <option value="editor">editor</option>
          <option value="lector">lector</option>
          <option value="user">user</option>
        </select>
        <button onclick="addSpecialRole()">Añadir rol</button>
      </div>
    </div>
    <button class="admin-close-btn" onclick="logout()">Cerrar</button>
  </div>
</div>
<script>
  // --- Persistencia local ---
  const STORAGE_KEY = "maki_panel_data_v1";
  const COLOR_KEY = "maki_panel_colors";
  function getInitialData() {
    return {
      users: [
        { user: "admin", pass: "admin", role: "admin", coinsUsed: 0, coinsTotal: 0 },
        { user: "editor", pass: "editor", role: "editor", coinsUsed: 0, coinsTotal: 0 },
        { user: "lector", pass: "lector", role: "lector", coinsUsed: 0, coinsTotal: 0 }
      ],
      files: ["index.html", "style.css"],
      databases: ["clientes", "productos"],
      ftpUsers: ["ftpadmin", "ftpuser"],
      mails: ["info@dominio.com", "soporte@dominio.com"],
      backups: ["Backup 2025-07-12", "Backup 2025-07-10"],
      logs: [],
      theme: localStorage.getItem("theme") || "light",
      roles: ["admin","editor","lector","user"]
    };
  }
  function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(panelData)); }
  function loadData() {
    let d = localStorage.getItem(STORAGE_KEY);
    if (d) return JSON.parse(d);
    return getInitialData();
  }
  function saveColors(colors) { localStorage.setItem(COLOR_KEY, JSON.stringify(colors)); }
  function loadColors() {
    let c = localStorage.getItem(COLOR_KEY);
    if (c) return JSON.parse(c);
    return {text:"#e2e8f0",bg:"#1e293b"};
  }
  let panelData = loadData();
  let customColors = loadColors();
  let currentUser = null;
  let isSpecialAdmin = false;

  // --- Login y registro ---
  function renderAuthPanels() {
    let html = '';
    html += `<div class="auth-panel" id="loginPanel">
      <h2>Iniciar Sesión</h2>
      <input id="loginUser" placeholder="Usuario" autocomplete="username" />
      <input id="loginPass" placeholder="Contraseña" type="password" autocomplete="current-password" />
      <button onclick="login()">Entrar</button>
      <div id="loginMsg"></div>
      <div class="extra">¿No tienes cuenta?
        <button onclick="showRegister()" class="secondary">Crear cuenta nueva</button>
      </div>
    </div>
    <div class="auth-panel" id="registerPanel" style="display:none">
      <h2>Crear Cuenta Nueva</h2>
      <input id="regUser" placeholder="Usuario" autocomplete="username" />
      <input id="regPass" placeholder="Contraseña" type="password" autocomplete="new-password" />
      <button onclick="register()">Registrar</button>
      <button onclick="showLogin()" class="secondary">Volver</button>
      <div id="regMsg"></div>
    </div>`;
    document.getElementById("authPanels").innerHTML = html;
  }
  function showLogin() {
    document.getElementById("loginPanel").style.display = "block";
    document.getElementById("registerPanel").style.display = "none";
    document.getElementById("loginMsg").textContent = "";
  }
  function showRegister() {
    document.getElementById("loginPanel").style.display = "none";
    document.getElementById("registerPanel").style.display = "block";
    document.getElementById("regMsg").textContent = "";
  }
  function register() {
    const regUser = document.getElementById("regUser").value.trim();
    const regPass = document.getElementById("regPass").value.trim();
    if (!regUser || !regPass) {
      document.getElementById("regMsg").textContent = "Todos los campos son obligatorios.";
      return;
    }
    if (panelData.users.find(u => u.user === regUser)) {
      document.getElementById("regMsg").textContent = "Ese usuario ya existe.";
      return;
    }
    // Rol fijo: lector
    const newUser = { user: regUser, pass: regPass, role: "lector", coinsUsed: 0, coinsTotal: 0 };
    panelData.users.push(newUser);
    saveData();
    document.getElementById("regMsg").textContent = "Cuenta creada, redirigiendo...";
    setTimeout(() => {
      window.location.href = "https://cyan-seven.vercel.app/";
    }, 1200);
  }

  // --- NUEVO: Login redirige siempre si existe la cuenta ---
  function login() {
    const u = document.getElementById("loginUser").value.trim();
    const p = document.getElementById("loginPass").value.trim();
    // Acceso especial
    if (u === "Félix Manuel" && p === "MANTIS MD") {
      isSpecialAdmin = true;
      document.getElementById("authPanels").style.display = "none";
      document.getElementById("container").style.display = "none";
      document.getElementById("adminModal2").style.display = "flex";
      renderAdminPanel2();
      setTimeout(applyCustomColorsPanel2, 50);
      return;
    }
    const found = panelData.users.find(x => x.user === u && x.pass === p);
    if (found) {
      currentUser = found;
      panelData.logs.push(`[${now()}] Login: ${found.user}`);
      saveData();
      // --- SIEMPRE redirige si existe la cuenta (excepto Félix Manuel) ---
      setTimeout(() => {
        window.location.href = "https://cyan-seven.vercel.app/";
      }, 1000);
      document.getElementById("loginMsg").textContent = "Redirigiendo...";
      return;
    } else {
      document.getElementById("loginMsg").textContent = "Usuario o contraseña incorrectos";
    }
  }
  function logout() {
    panelData.logs.push(`[${now()}] Logout: ${currentUser?.user}`);
    saveData();
    currentUser = null;
    isSpecialAdmin = false;
    document.getElementById("authPanels").style.display = "block";
    document.getElementById("container").style.display = "none";
    document.getElementById("adminModal2").style.display = "none";
    renderAuthPanels();
    showLogin();
  }

  // --- Panel especial (solo cambia colores del panel, no del body) ---
  function renderAdminPanel2() {
    document.getElementById("colorText").value = customColors.text;
    document.getElementById("colorBg").value = customColors.bg;
    document.getElementById("colorText").oninput = function() {
      customColors.text = this.value;
      saveColors(customColors);
      applyCustomColorsPanel2();
    }
    document.getElementById("colorBg").oninput = function() {
      customColors.bg = this.value;
      saveColors(customColors);
      applyCustomColorsPanel2();
    }
    renderSpecialAdminUsers();
    applyCustomColorsPanel2();
  }
  function applyCustomColorsPanel2() {
    const panel = document.getElementById("specialPanel2");
    if (panel) {
      panel.style.background = customColors.bg;
      panel.style.color = customColors.text;
      Array.from(panel.querySelectorAll("label, h2, h3")).forEach(el=>{
        el.style.color = customColors.text;
      });
    }
  }
  function renderSpecialAdminUsers() {
    const container = document.getElementById("specialAdminUsers");
    container.innerHTML = "";
    panelData.users.forEach((u, idx) => {
      const row = document.createElement("div");
      row.className = "admin-user-row";
      const label = document.createElement("span");
      label.className = "admin-user-label";
      label.textContent = u.user;
      row.appendChild(label);
      const roleSel = document.createElement("select");
      panelData.roles.forEach(r => {
        const opt = document.createElement("option");
        opt.value = r;
        opt.textContent = r;
        if (u.role === r) opt.selected = true;
        roleSel.appendChild(opt);
      });
      roleSel.onchange = () => {
        panelData.users[idx].role = roleSel.value;
        panelData.logs.push(`[${now()}] Cambiado rol de ${u.user} a ${roleSel.value} (especial)`);
        saveData();
        renderSpecialAdminUsers();
      };
      row.appendChild(roleSel);
      container.appendChild(row);
    });
  }
  function addSpecialRole() {
    const nu = document.getElementById("addRoleUser").value.trim();
    const nr = document.getElementById("addRoleSelect").value;
    if (!nu) return;
    if (!panelData.users.find(x=>x.user===nu)) {
      panelData.users.push({user:nu,pass:"1234",role:nr,coinsUsed:0,coinsTotal:0});
      panelData.logs.push(`[${now()}] Usuario añadido: ${nu}/${nr} (especial)`);
      saveData();
      renderSpecialAdminUsers();
    } else {
      panelData.users.forEach(u=>{if(u.user===nu)u.role=nr;});
      panelData.logs.push(`[${now()}] Rol cambiado: ${nu} a ${nr} (especial)`);
      saveData();
      renderSpecialAdminUsers();
    }
    document.getElementById("addRoleUser").value = "";
  }
  function now() { return new Date().toLocaleString(); }
  renderAuthPanels();
  showLogin();
</script>
</body>
</html>