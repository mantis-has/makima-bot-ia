<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Hosting</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
  <style>
    body { margin:0; font-family:sans-serif; background:linear-gradient(135deg,#101820 0%,#38bdf8 100%); min-height:100vh; color:#e2e8f0; }
    .container { display:flex; min-height:100vh; }
    .sidebar { background:#101820; width:70px; min-width:70px; display:flex; flex-direction:column; align-items:center; padding-top:36px; box-shadow:2px 0 14px #00fff77a; gap:0.3em; z-index:10; }
    .logo { font-size:2em; font-weight:bold; color:#00fff7; margin-bottom:22px; letter-spacing:2px; text-shadow:0 2px 8px #00fff766; }
    .side-btn, .admin-btn { background:transparent; border:none; color:#00fff7; font-size:1.6em; margin:0.3em 0; border-radius:12px; transition:background 0.15s, color 0.2s; width:52px; height:52px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
    .side-btn.active, .side-btn:hover, .admin-btn.active, .admin-btn:hover { background:#00fff71a; color:#fff; }
    .admin-btn { margin-top:1.5em; font-size:1.7em; display:none; }
    .main { flex:1; display:flex; flex-direction:column; align-items:stretch; min-height:100vh; padding:0 0.5em; margin-bottom:54px; }
    .topbar { display:flex; align-items:center; padding:0 28px; height:72px; background:rgba(56,189,248,0.09); box-shadow:0 4px 24px #00fff722; z-index:8; position:relative; }
    .topbar .title { font-size:1.4em; font-weight:600; color:#fff; letter-spacing:1px; margin-right:auto;}
    .topbar .logout-btn { background:#00fff7; color:#101820; border:none; border-radius:7px; padding:8px 16px; font-weight:bold; font-size:1em; margin-left:16px; cursor:pointer; box-shadow:0 2px 14px #00fff74a; transition:background 0.15s, color 0.2s;}
    .auth-panel { max-width:370px; margin:80px auto; background:#101820e8; box-shadow:0 2px 24px #00fff72a; border-radius:16px; padding:36px 32px; text-align:center; color:#e2e8f0;}
    .auth-panel h2 { margin-bottom:18px; color:#00fff7; font-weight:600; font-size:1.5em;}
    .auth-panel input { width:90%; padding:8px 12px; border:none; border-radius:7px; background:#1c232b; color:#00fff7; margin-bottom:14px; font-size:1.07em; outline:none; transition:box-shadow 0.15s;}
    .auth-panel input:focus { box-shadow:0 0 0 2px #00fff7;}
    .auth-panel button { background:#00fff7; color:#101820; border-radius:7px; border:none; font-weight:bold; font-size:1em; padding:9px 22px; margin-top:4px; cursor:pointer; margin-bottom:8px; box-shadow:0 2px 10px #00fff74a;}
    .auth-panel .secondary { background:#1c232b; color:#00fff7; border:1px solid #00fff7; margin-left:8px;}
    .auth-panel .extra { margin-top:16px; font-size:0.98em;}
    .card-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(270px,1fr)); gap:24px; margin:36px 30px 0 30px;}
    .card, .admin-panel, .modal-content { background:#1c232b; border-radius:16px; box-shadow:0 2px 18px #00fff72c; color:#e2e8f0; display:flex; flex-direction:column; min-height:120px; position:relative; padding:28px 22px 22px 22px; border:2px solid #00fff7;}
    .card h3 { margin-top:0; margin-bottom:10px; color:#00fff7; font-size:1.15em; font-weight:600;}
    .card .coin-value { font-size:2.3em; font-weight:bold; color:#00fff7; margin-top:10px;}
    .card .card-btn { margin-top:16px; padding:8px 14px; background:#00fff7; color:#101820; border:none; border-radius:7px; font-weight:500; cursor:pointer; font-size:1em; box-shadow:0 2px 10px #00fff74a; transition:background 0.15s, color 0.2s;}
    .card .card-btn:disabled { background:#1c232b; color:#94a3b8; cursor:not-allowed; border:1px solid #00fff7;}
    .list-ul { list-style:none; padding:0; margin:0 0 8px 0;}
    .list-ul li { background:#101820; color:#00fff7; margin-bottom:9px; padding:8px 16px; border-radius:7px; font-size:1.06em; display:flex; align-items:center; justify-content:space-between;}
    .list-ul li .del-btn { background:#00fff7; color:#101820; border:none; border-radius:5px; padding:2px 8px; margin-left:10px; font-size:0.95em; cursor:pointer; transition:background 0.15s, color 0.2s;}
    .list-ul li .del-btn:hover { background:#101820; color:#00fff7; border:1px solid #00fff7;}
    .footer { width:100%; background:#101820; color:#00fff7; padding:18px 0 10px 0; text-align:center; font-size:1.05em; position:fixed; left:0; bottom:0; z-index:99; letter-spacing:1px;}
    .admin-modal-bg, .modal-bg { position:fixed; top:0; left:0; right:0; bottom:0; background:#101820cc; z-index:999; display:flex; align-items:center; justify-content:center;}
    .admin-panel, .modal-content { min-width:320px; max-width:450px; position:relative; box-shadow:0 4px 36px #00fff722; padding:36px 32px; border:2px solid #00fff7;}
    .admin-panel h2, .modal-content h2 { margin-top:0; margin-bottom:22px; color:#00fff7; font-size:1.14em; font-weight:bold; text-align:center;}
    .admin-user-row { display:flex; align-items:center; gap:8px; margin-bottom:13px;}
    .admin-user-label { flex:1.2; font-weight:600; color:#fff; font-size:1.07em;}
    .admin-user-row select, .admin-user-row input, .modal-content input, .modal-content textarea { background:#1c232b; color:#00fff7; border:1px solid #00fff7; padding:4px 6px; border-radius:5px; font-size:1em; outline:none; margin-right:2px;}
    .admin-user-row button, .modal-content button { background:#00fff7; color:#101820; border:none; border-radius:5px; padding:3px 12px; cursor:pointer; font-weight:500; transition:background 0.15s, color 0.2s;}
    .admin-user-row button:hover, .modal-content button:hover { background:#101820; color:#00fff7; border:1px solid #00fff7;}
    .admin-close-btn, .modal-close-btn { background:#101820; color:#00fff7; border:2px solid #00fff7; margin-top:2em; padding:0.8em 2em; border-radius:7px; font-weight:bold; font-size:1em; margin-left:auto; margin-right:auto; cursor:pointer; display:block;}
    .hamburger { position:absolute; top:14px; left:20px; font-size:2em; color:#00fff7; background:none; border:none; cursor:pointer; z-index:99;}
    .user-menu { position:fixed; top:0; left:0; width:210px; height:100vh; background:#101820f0; box-shadow:2px 0 14px #00fff77a; padding-top:70px; z-index:1001; display:none; flex-direction:column; }
    .user-menu button { background:none; border:none; color:#00fff7; font-size:1.15em; text-align:left; padding:16px 24px; cursor:pointer; width:100%; transition:background 0.15s, color 0.2s;}
    .user-menu button:hover { background:#00fff71a; color:#fff;}
    .user-menu .close-menu { font-size:1.4em; position:absolute; top:12px; right:16px; background:none; border:none; color:#00fff7; cursor:pointer;}
    .console-area { background:#101820; color:#00fff7; border-radius:8px; padding:12px; font-size:1em; height:160px; overflow-y:auto; margin-bottom:10px;}
    .console-input-row { display:flex; gap:8px;}
    .console-input { flex:1; background:#1c232b; color:#00fff7; border:1px solid #00fff7; border-radius:5px; padding:4px;}
    .console-send-btn { background:#00fff7; color:#101820; border:none; border-radius:5px; padding:4px 15px; cursor:pointer; font-weight:500;}
    @media (max-width:650px){ .card-grid{grid-template-columns:1fr;} .sidebar{width:56px;min-width:56px;} .sidebar .logo{font-size:1.2em;} .main{margin-bottom:54px;} .topbar{height:54px;} .topbar .title{font-size:1.1em;} }
  </style>
</head>
<body>
<div id="authPanels"></div>
<div class="container" id="container" style="display:none">
  <div class="sidebar" id="sidebar">
    <div class="logo">Maki</div>
    <button class="side-btn" id="btn-dashboard" title="Dashboard"><i class="ri-dashboard-3-line"></i></button>
    <button class="admin-btn" id="btn-admin" title="Panel Administrativo" onclick="showAdminCodeModal()"><i class="ri-shield-user-line"></i></button>
  </div>
  <div class="main">
    <div class="topbar">
      <span class="title" id="topbar-title">Panel de Usuario</span>
      <button class="logout-btn" onclick="logout()">Salir</button>
    </div>
    <button class="hamburger" onclick="openUserMenu()" id="hamburgerBtn"><i class="ri-menu-line"></i></button>
    <div id="userMenu" class="user-menu"></div>
    <div id="dashboardPanel" class="card-grid"></div>
    <div id="serversPanel" class="card-grid" style="display:none"></div>
    <div id="ticketsPanel" class="card-grid" style="display:none"></div>
    <div id="storePanel" class="card-grid" style="display:none"></div>
    <div id="adminModal" class="admin-modal-bg" style="display:none">
      <div class="admin-panel">
        <h2>Panel de Administraci√≥n</h2>
        <div id="adminUsers"></div>
        <button onclick="showAnnouncementModal()" style="margin-bottom: 14px;">üõ†Ô∏è Crear anuncio</button>
        <button onclick="closeAdminModal()" class="admin-close-btn">Cerrar</button>
      </div>
    </div>
    <div id="adminCodeModal" class="modal-bg" style="display:none">
      <div class="modal-content">
        <h2>Ingresa el c√≥digo de administrador</h2>
        <input id="adminCodeInput" placeholder="C√≥digo" autocomplete="off" />
        <div id="adminCodeMsg" style="color:#00fff7; margin-top:12px;"></div>
        <button onclick="checkAdminCode()">Entrar</button>
        <button onclick="closeAdminCodeModal()" class="modal-close-btn">Cancelar</button>
      </div>
    </div>
    <div id="announcementModal" class="modal-bg" style="display:none;">
      <div class="modal-content">
        <h2>üõ†Ô∏è Crear anuncio</h2>
        <textarea id="announcementInput" rows="3" style="margin-bottom:10px;resize:none;" placeholder="Escribe el anuncio aqu√≠"></textarea>
        <button onclick="saveAnnouncement()">Guardar anuncio</button>
        <button onclick="closeAnnouncementModal()" class="modal-close-btn">Cancelar</button>
      </div>
    </div>
    <div id="editUserModal" class="modal-bg" style="display:none;">
      <div class="modal-content">
        <h2>Editar usuario</h2>
        <div id="editUserForm"></div>
        <button onclick="saveEditedUser()">Guardar cambios</button>
        <button onclick="closeEditUserModal()" class="modal-close-btn">Cancelar</button>
      </div>
    </div>
  </div>
</div>
<div class="footer">¬© Panel Simulado Hosting | Todos los derechos reservados</div>
<script>
const STORAGE_KEY = "panel_sim_host_v1";
function getInitialData() {
  return {
    users: [
      { user:"admin", pass:"admin", correo:"admin@host.com", role:"admin", coinsUsed:0, coinsTotal:1000, servidores:[], bases:[] },
      { user:"editor", pass:"editor", correo:"editor@host.com", role:"editor", coinsUsed:0, coinsTotal:300, servidores:[], bases:[] },
    ],
    announcement: "",
  };
}
function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(panelData)); }
function loadData() {
  let d = localStorage.getItem(STORAGE_KEY);
  if (d) return JSON.parse(d);
  return getInitialData();
}
let panelData = loadData();
let currentUser = null;
let editUserIdx = null;

const panels = ["dashboardPanel","serversPanel","ticketsPanel","storePanel"];
function showPanel(idx) {
  panels.forEach((id,i)=>{
    document.getElementById(id).style.display = (i===idx)?"grid":"none";
  });
  renderAll();
}

document.getElementById("btn-dashboard").onclick = ()=>showPanel(0);

function renderAuthPanels() {
  let html = '';
  html += `<div class="auth-panel" id="loginPanel">
    <h2>Iniciar Sesi√≥n</h2>
    <input id="loginUser" placeholder="Usuario" autocomplete="username" />
    <input id="loginPass" placeholder="Contrase√±a" type="password" autocomplete="current-password" />
    <button onclick="login()">Entrar</button>
    <div id="loginMsg"></div>
    <div class="extra">¬øNo tienes cuenta?
      <button onclick="showRegister()" class="secondary">Crear cuenta nueva</button>
    </div>
  </div>
  <div class="auth-panel" id="registerPanel" style="display:none">
    <h2>Crear Cuenta Nueva</h2>
    <input id="regUser" placeholder="Usuario" autocomplete="username" />
    <input id="regPass" placeholder="Contrase√±a" type="password" autocomplete="new-password" />
    <input id="regCorreo" placeholder="Correo" autocomplete="email" />
    <button onclick="register()">Registrar</button>
    <button onclick="showLogin()" class="secondary">Volver</button>
    <div id="regMsg"></div>
  </div>`;
  document.getElementById("authPanels").innerHTML = html;
}
function showLogin() {
  document.getElementById("loginPanel").style.display = "block";
  document.getElementById("registerPanel").style.display = "none";
  document.getElementById("loginMsg").textContent = "";
}
function showRegister() {
  document.getElementById("loginPanel").style.display = "none";
  document.getElementById("registerPanel").style.display = "block";
  document.getElementById("regMsg").textContent = "";
}
function register() {
  const regUser = document.getElementById("regUser").value.trim();
  const regPass = document.getElementById("regPass").value.trim();
  const regCorreo = document.getElementById("regCorreo").value.trim();
  if (!regUser || !regPass || !regCorreo) {
    document.getElementById("regMsg").textContent = "Todos los campos son obligatorios.";
    return;
  }
  if (panelData.users.find(u => u.user === regUser)) {
    document.getElementById("regMsg").textContent = "Ese usuario ya existe.";
    return;
  }
  const newUser = {
    user: regUser, pass: regPass, correo: regCorreo, role: "lector",
    coinsUsed:0, coinsTotal:0, servidores:[], bases:[]
  };
  panelData.users.push(newUser);
  saveData();
  document.getElementById("regMsg").textContent = "Cuenta creada, ahora puedes iniciar sesi√≥n.";
  setTimeout(() => { showLogin(); document.getElementById("loginUser").value = regUser; }, 1000);
}
function login() {
  const u = document.getElementById("loginUser").value;
  const p = document.getElementById("loginPass").value;
  const found = panelData.users.find(x => x.user === u && x.pass === p);
  if (found) {
    currentUser = found;
    document.getElementById("authPanels").style.display = "none";
    document.getElementById("container").style.display = "flex";
    showPanel(0);
    updateSidebarState();
  } else {
    document.getElementById("loginMsg").textContent = "Usuario o contrase√±a incorrectos";
  }
}
function logout() {
  currentUser = null;
  document.getElementById("authPanels").style.display = "block";
  document.getElementById("container").style.display = "none";
  renderAuthPanels();
  showLogin();
}

function renderAll() {
  renderDashboard();
  renderServers();
  renderTickets();
  renderStore();
  updateSidebarState();
  renderUserMenu();
}
function updateSidebarState() {
  document.getElementById("btn-admin").style.display = "block";
}

function openUserMenu() {
  renderUserMenu();
  document.getElementById("userMenu").style.display = "flex";
}
function closeUserMenu() {
  document.getElementById("userMenu").style.display = "none";
}
function renderUserMenu() {
  let html = `<button onclick="closeUserMenu()" class="close-menu"><i class="ri-close-line"></i></button>
    <button onclick="showPanel(0);closeUserMenu();">Principal</button>
    <button onclick="showPanel(1);closeUserMenu();">Servidores</button>
    <button onclick="showPanel(2);closeUserMenu();">Tickets</button>
    <button onclick="showPanel(3);closeUserMenu();">Tienda</button>`;
  document.getElementById("userMenu").innerHTML = html;
}

function renderDashboard() {
  let anuncio = panelData.announcement ? `<div style="background:#101820;color:#00fff7;border-radius:7px;padding:8px 12px;font-weight:bold;margin-bottom:10px;">
    üõ†Ô∏èAnuncio de admins<br>${panelData.announcement}</div>` : "";
  document.getElementById("dashboardPanel").innerHTML = `
    <div class="card" style="box-shadow:0 0 24px #00fff7;">
      ${anuncio}
      <h3><i class="ri-coins-line"></i> Coins en uso</h3>
      <div class="coin-value" id="coinsUsed">${currentUser?.coinsUsed?.toFixed(2) ?? "0,00"}</div>
    </div>
    <div class="card" style="box-shadow:0 0 24px #00fff7;">
      <h3><i class="ri-copper-coin-line"></i> Coins totales</h3>
      <div class="coin-value" id="coinsTotal">${currentUser?.coinsTotal?.toFixed(2) ?? "0,00"}</div>
    </div>
    <div class="card" style="grid-column:span 2;box-shadow:0 0 24px #00fff7;">
      <h3><i class="ri-user-line"></i> Informaci√≥n de usuario</h3>
      <b>Usuario:</b> ${currentUser.user}<br>
      <b>Correo:</b> ${currentUser.correo}<br>
      <b>Rol:</b> ${currentUser.role}
    </div>
  `;
}

function renderServers() {
  let html = `<div class="card">
    <h3><i class="ri-server-line"></i> Servidores</h3>`;
  if (!currentUser.servidores.length) html += `<div style="margin-bottom:8px;">No tienes servidores.</div>`;
  currentUser.servidores.forEach((srv,i)=>{
    html += `<div style="background:#101820;color:#00fff7;border-radius:7px;padding:8px 12px;margin-bottom:6px;">
      <b>${srv.nombre}</b> (${srv.coins} coins) <button onclick="openServerModal(${i})">Abrir</button>
    </div>`;
  });
  html += `<button class="card-btn" onclick="createServer()">+ Crear servidor</button></div>`;
  document.getElementById("serversPanel").innerHTML = html;
}

function openServerModal(idx) {
  let srv = currentUser.servidores[idx];
  let html = `<button onclick="closeServerModal()" class="close-menu" style="position:absolute;top:16px;right:20px;">‚úñ</button>
    <div style="margin-bottom:18px;">
      <button onclick="showServerTab('consola')" id="tabConsola">Console</button>
      <button onclick="showServerTab('files')" id="tabFiles">Files</button>
      <button onclick="showServerTab('startup')" id="tabStartup">Startup</button>
    </div>
    <div id="serverTabContent"></div>
  `;
  showModal(html, "Servidor: " + srv.nombre);
  showServerTab('consola', srv);
  window.currentServerIdx = idx;
}
function showServerTab(tab, srv) {
  let idx = window.currentServerIdx;
  srv = srv || currentUser.servidores[idx];
  let html = "";
  if (tab==="consola") {
    html = `<div class="console-area" id="consoleOutput">${srv.consola||""}</div>
            <div class="console-input-row">
              <input class="console-input" id="consoleCmdInput" placeholder="Comando..." autocomplete="off">
              <button class="console-send-btn" onclick="sendServerCmd(${idx})">Enviar</button>
            </div>`;
  } else if (tab==="files") {
    html = `<div><b>Archivos:</b></div>
      <ul class="list-ul" id="serverFileList">${(srv.files||[]).map(f=>`<li>${f}</li>`).join("")}</ul>
      <input id="newServerFile" placeholder="Subir archivo (nombre)" />
      <button onclick="addServerFile(${idx})" class="card-btn">Subir</button>`;
  } else if (tab==="startup") {
    html = `<div><b>Startup (repositorio GitHub):</b></div>
      <input id="startupRepo" placeholder="URL o nombre del repo" value="${srv.startupRepo||""}">
      <button onclick="saveStartupRepo(${idx})" class="card-btn">Guardar</button>
      <div style="margin-top:10px;color:#00fff7;">Ejemplo: user/repo o https://github.com/user/repo</div>`;
  }
  document.getElementById("serverTabContent").innerHTML = html;
  ["tabConsola","tabFiles","tabStartup"].forEach(el=>document.getElementById(el).style.background="#101820");
  document.getElementById("tab"+tab.charAt(0).toUpperCase()+tab.slice(1)).style.background="#00fff71a";
}
function closeServerModal() { closeModal(); }
function sendServerCmd(idx) {
  let cmd = document.getElementById("consoleCmdInput").value;
  if (!cmd) return;
  let srv = currentUser.servidores[idx];
  let out = srv.consola||"";
  out += "\n$ " + cmd;
  if (cmd.includes("git clone") || cmd.includes("instalar repo") || cmd.includes("npm install")) {
    out += "\nInstalando repositorio...";
  } else if (cmd.includes("run bot")) {
    out += "\nBot de WhatsApp iniciado!";
  } else {
    out += "\nComando ejecutado: " + cmd;
  }
  srv.consola = out;
  saveData();
  showServerTab('consola', srv);
  document.getElementById("consoleCmdInput").value = "";
}
function addServerFile(idx) {
  let f = document.getElementById("newServerFile").value.trim();
  if (!f) return;
  let srv = currentUser.servidores[idx];
  if (!srv.files) srv.files = [];
  srv.files.push(f);
  saveData();
  showServerTab('files', srv);
  document.getElementById("newServerFile").value = "";
}
function saveStartupRepo(idx) {
  let repo = document.getElementById("startupRepo").value.trim();
  let srv = currentUser.servidores[idx];
  srv.startupRepo = repo;
  saveData();
  showServerTab('startup', srv);
}

function createServer() {
  if (currentUser.coinsTotal < 100) {
    alert("Necesitas al menos 100 coins para crear un servidor.");
    return;
  }
  let nombre = prompt("Nombre del servidor:");
  if (!nombre) return;
  currentUser.servidores.push({nombre,coins:100,consola:"",files:[],startupRepo:""});
  saveData();
  renderServers();
}

function renderTickets() {
  document.getElementById("ticketsPanel").innerHTML = `<div class="card">
    <h3><i class="ri-question-line"></i> Tickets</h3>
    <div>No hay tickets a√∫n.</div>
  </div>`;
}

function renderStore() {
  let html = `<div class="card">
    <h3><i class="ri-shopping-cart-line"></i> Tienda</h3>
    <b>Plan 1: 200 coins</b> <button onclick="buyPlan(200,'MAK28')">Comprar</button><br>
    <b>Plan 2: 400 coins</b> <button onclick="buyPlan(400,'MAK29')">Comprar</button><br>
    <b>Plan 3: 200 coins</b> <button onclick="buyPlan(200,'MAK30')">Comprar</button><br>
    <b>Plan 4: 400 coins</b> <button onclick="buyPlan(400,'MAK21')">Comprar</button><br>
    <div id="storeMsg" style="color:#00fff7;margin-top:10px;"></div>
  </div>`;
  document.getElementById("storePanel").innerHTML = html;
}
function buyPlan(coins, token) {
  let t = prompt("Introduce el token de compra:");
  if (!["MAK28","MAK29","MAK30","MAK21"].includes(t)) {
    document.getElementById("storeMsg").textContent = "Token incorrecto.";
    return;
  }
  currentUser.coinsTotal += coins;
  saveData();
  document.getElementById("storeMsg").textContent = "¬°Compra exitosa! Coins a√±adidos.";
  renderDashboard();
}

function showAdminCodeModal() {
  document.getElementById("adminCodeModal").style.display = "flex";
  document.getElementById("adminCodeInput").value = "";
  document.getElementById("adminCodeMsg").textContent = "";
}
function closeAdminCodeModal() {
  document.getElementById("adminCodeModal").style.display = "none";
}
function checkAdminCode() {
  let c = document.getElementById("adminCodeInput").value.trim();
  if (c !== "MAK1") {
    document.getElementById("adminCodeMsg").textContent = "C√≥digo incorrecto.";
    return;
  }
  document.getElementById("adminCodeModal").style.display = "none";
  showAdminPanel();
}
function showAdminPanel() {
  document.getElementById("adminModal").style.display = "flex";
  renderAdminUsers();
}
function closeAdminModal() {
  document.getElementById("adminModal").style.display = "none";
}
function renderAdminUsers() {
  let container = document.getElementById("adminUsers");
  container.innerHTML = "";
  panelData.users.forEach((u, idx) => {
    const row = document.createElement("div");
    row.className = "admin-user-row";
    const correo = document.createElement("span");
    correo.className = "admin-user-label";
    correo.textContent = u.correo;
    row.appendChild(correo);
    const editBtn = document.createElement("button");
    editBtn.innerHTML = '<i class="ri-pencil-line"></i>';
    editBtn.onclick = ()=>openEditUserModal(idx);
    row.appendChild(editBtn);
    container.appendChild(row);
  });
}
function openEditUserModal(idx) {
  editUserIdx = idx;
  let u = panelData.users[idx];
  let html = `
    <label>Correo: <input id="editCorreo" value="${u.correo}" /></label><br>
    <label>Coins usados: <input type="number" id="editCoinsUsed" value="${u.coinsUsed}" /></label><br>
    <label>Coins totales: <input type="number" id="editCoinsTotal" value="${u.coinsTotal}" /></label><br>
    <label>Servidores: <input id="editServidores" value="${u.servidores.map(s=>s.nombre).join(',')}" placeholder="nombres separados por coma" /></label><br>
    <label>Bases de datos: <input id="editBases" value="${u.bases.join(',')}" placeholder="bases separadas por coma" /></label>
  `;
  document.getElementById("editUserForm").innerHTML = html;
  document.getElementById("editUserModal").style.display = "flex";
}
function closeEditUserModal() {
  document.getElementById("editUserModal").style.display = "none";
}
function saveEditedUser() {
  let u = panelData.users[editUserIdx];
  u.correo = document.getElementById("editCorreo").value;
  u.coinsUsed = parseFloat(document.getElementById("editCoinsUsed").value)||0;
  u.coinsTotal = parseFloat(document.getElementById("editCoinsTotal").value)||0;
  let servers = document.getElementById("editServidores").value.split(',').map(s=>s.trim()).filter(Boolean);
  u.servidores = servers.map(s=>({nombre:s,coins:100,consola:"",files:[],startupRepo:""}));
  u.bases = document.getElementById("editBases").value.split(',').map(b=>b.trim()).filter(Boolean);
  saveData();
  renderAdminUsers();
  closeEditUserModal();
  if (currentUser && u.user === currentUser.user) {
    currentUser = u;
    renderAll();
  }
}

function showAnnouncementModal() {
  document.getElementById("announcementInput").value = panelData.announcement;
  document.getElementById("announcementModal").style.display = "flex";
}
function closeAnnouncementModal() {
  document.getElementById("announcementModal").style.display = "none";
}
function saveAnnouncement() {
  panelData.announcement = document.getElementById("announcementInput").value;
  saveData();
  renderDashboard();
  closeAnnouncementModal();
}

function showModal(html, titulo) {
  let div = document.createElement("div");
  div.className = "modal-bg";
  div.innerHTML = `<div class="modal-content"><h2>${titulo||""}</h2>${html}</div>`;
  document.body.appendChild(div);
  window.currentModal = div;
}
function closeModal() {
  if (window.currentModal) document.body.removeChild(window.currentModal);
  window.currentModal = null;
}

function now() { return new Date().toLocaleString(); }

renderAuthPanels();
showLogin();
</script>
</body>
</html>